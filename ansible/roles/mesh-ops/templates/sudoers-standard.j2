# Sudoers configuration for mesh-ops user - Standard (Fedora/RHEL)
# Deployed by Ansible on {{ ansible_date_time.iso8601 }}
# Node: {{ ansible_hostname }}

# Allow mesh-ops to manage Tailscale ONLY
{{ mesh_user }} ALL=(ALL) NOPASSWD: /usr/bin/systemctl restart tailscaled
{{ mesh_user }} ALL=(ALL) NOPASSWD: /usr/bin/systemctl start tailscaled
{{ mesh_user }} ALL=(ALL) NOPASSWD: /usr/bin/systemctl stop tailscaled
{{ mesh_user }} ALL=(ALL) NOPASSWD: /usr/bin/systemctl status tailscaled
{{ mesh_user }} ALL=(ALL) NOPASSWD: /usr/bin/tailscale *

# SAFETY: Never allow wildcards for critical services
# NEVER: systemctl stop/start/restart * (can kill SSH!)
# NEVER: systemctl * sshd (protect SSH service)

# Package management for Fedora/RHEL
{{ mesh_user }} ALL=(ALL) NOPASSWD: /usr/bin/dnf install -y *
{{ mesh_user }} ALL=(ALL) NOPASSWD: /usr/bin/dnf update -y
{{ mesh_user }} ALL=(ALL) NOPASSWD: /usr/bin/dnf search *
{{ mesh_user }} ALL=(ALL) NOPASSWD: /usr/bin/dnf info *

# Container management
{{ mesh_user }} ALL=(ALL) NOPASSWD: /usr/bin/docker *
{{ mesh_user }} ALL=(ALL) NOPASSWD: /usr/bin/podman *

# Firewall management
{{ mesh_user }} ALL=(ALL) NOPASSWD: /usr/bin/firewall-cmd *

# Systemd user session management (user scope only - safe)
{{ mesh_user }} ALL=(ALL) NOPASSWD: /bin/loginctl enable-linger {{ mesh_user }}
{{ mesh_user }} ALL=(ALL) NOPASSWD: /bin/loginctl disable-linger {{ mesh_user }}
{{ mesh_user }} ALL=(ALL) NOPASSWD: /bin/loginctl show-user {{ mesh_user }}
{{ mesh_user }} ALL=(ALL) NOPASSWD: /usr/bin/systemctl --user *